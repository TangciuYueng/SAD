### 登录与注册
```puml
title 登录与注册
|访客|
start
: 输入用户名与密码;

|系统|
if (账户存在?) then(no)
|系统|
: 提示注册;
|访客|
: 填写注册信息;

repeat
|系统|
: 发送验证码;
|访客|
: 输入验证码;
repeat while(验证码正确?) is (no)

|系统|
: 注册成功;
|用户|
: 用户权限登录;
: 填写用户习惯问卷;
stop

else(yes)
    |系统|
    if (用户名与密码是否匹配?) then(yes)
    : 登录成功;
        if (是否管理员?) then(yes)
        |管理员|
        : 管理员权限登录;
        stop
        else(no)
        |用户|
        : 用户权限登录;
        stop
        endif
    else(no)
    |系统|
    : 登录失败;
    endif
    stop
```

## 随笔管理
### 发布随笔
```puml
title 发布随笔
|用户|
start
: 编辑随笔内容;
: 设置公开性;
: 申请发送;

|系统|
if (审核通过?) then(yes)
: 调用音乐推荐算法;
: 更新数据库;
: 随笔发布成功;
else(no)
stop
endif

|用户|
: 浏览随笔;
stop
```
### 评论随笔
```puml
title 评论随笔
|用户|
start
: 编辑评论内容;
: 申请发送;

|系统|
if (审核通过?) then(yes)
: 更新数据库;
: 评论发布成功;
: 发送评论提醒;
else(no)
stop
endif

|用户|
: 浏览评论;
stop
```
### 删除随笔
```puml
title 删除随笔
|用户|
: 申请删除随笔;

|系统|
if (是否管理员?) then(no)
|系统|
: 返回个人随笔数据;
|用户|
: 选择删除;
stop

else(yes)
|系统|
: 返回所有随笔数据;
|管理员|
: 选择删除;
stop
```

### 创建歌单
```puml
title 创建歌单
|用户|
start
: 申请创建歌单;
: 填写主题;
: 设置公开性;

|系统|
: 生成推荐音乐;

|用户|
: 选择音乐;
: 上传音乐;

|系统|
if (审核通过?) then(yes)
: 更新数据库;
: 创建成功;
: 匹配相关情绪用户;
: 推荐至用户主页;
|用户|
: 听音乐;
else(no);
|系统|
: 创建失败;
endif
|系统|
stop
```

### 心情打卡
```puml
title 心情打卡
|用户|
start
: 申请心情打卡;
|系统|
: 发送问卷;
|用户|
: 填写问卷;
|系统|
: 调用推荐算法;
: 生成推荐音乐;
: 更新数据库;
|用户|
: 接受音乐;
stop
```

## 音乐室系统
### 创建活动室
```puml
title 创建活动室
|用户|
start
: 申请创建活动室;
: 填写主题、人数与时间段;

|系统|
if (是否有空闲活动室?) then(yes)
: 为创建者添加该活动室群主权限;
: 更新数据库;
: 匹配相关情绪用户;
: 发送活动室推荐;
|用户|
: 创建活动室歌单;

else(no)
|系统|
: 创建失败;
endif
stop
```

### 退出活动室
```puml
title 退出活动室
|用户|
start
: 申请退出活动室;

|系统|
if (是否群主?) then(yes)
|系统|
: 发送提示转移群主身份;
|用户|
: 选择群内用户转移群主身份;



else(no)
endif
|系统|
: 退出成功;
stop
```

### 群内唱歌
```puml
title 群内唱歌
|用户|
start
: 申请唱歌;
: 选择歌曲;

|系统|
if (是否群管理员?) then(yes)
|群管理员|
fork 
: 调整歌单顺序;
fork again
: 增删歌单;
endfork

else(no)
|群管理员|
if (审核通过?) then(yes)
: 加入等待唱歌队列;
endif


if (无人等待) then(yes)
|用户|
: 唱歌;
endif
endif
|系统|
: 识别情绪;
: 推荐音乐至相关情绪用户;
: 更新数据库;
stop
```
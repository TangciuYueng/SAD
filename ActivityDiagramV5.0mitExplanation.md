### 登录与注册
```puml
title 登录与注册
|访客|
start
: 输入用户名与密码;

|系统|
if (账户存在?) then(no)
|系统|
: 提示注册;
|访客|
: 填写注册信息;

repeat
|系统|
: 发送验证码;
|访客|
: 输入验证码;
repeat while(验证码正确?) is (no)

|系统|
: 注册成功;
|用户|
: 用户权限登录;
: 填写用户习惯问卷;
stop

else(yes)
    |系统|
    if (用户名与密码是否匹配?) then(yes)
    : 登录成功;
        if (是否管理员?) then(yes)
        |管理员|
        : 管理员权限登录;
        stop
        else(no)
        |用户|
        : 用户权限登录;
        stop
        endif
    else(no)
    |系统|
    : 登录失败;
    endif
    stop
```
访客输入用户名和密码，如果账户不存在，则系统提示访客进行注册，访客需要填写注册信息并通过验证码验证后，注册成功，系统向用户提示填写用户习惯问卷；若验证码错误，重新发送验证码，重复上述过程。若访客拥有账户，可以使用其用户名和密码进行登录。如果用户名和密码匹配，则用户可以登录成功，并根据其身份（管理员或普通用户）获得相应的权限。如果用户名和密码不匹配，则登录失败。


## 随笔管理
### 发布随笔
```puml
title 发布随笔
|用户|
start
: 编辑随笔内容;
: 设置公开性;
: 申请发送;

|系统|
if (审核通过?) then(yes)
: 调用音乐推荐算法;
: 随笔发布成功;
else(no)
stop
endif

|用户|
: 浏览随笔;
stop
```

用户编辑随笔内容，且设置随笔的公开性之后，然后申请发送。接着，系统会进行审核，如果审核通过，则系统会调用音乐推荐算法，根据所发布的内容查询出适合其情绪的音乐，提示用户发布成功。如果审核不通过，则系统会停止流程。最后，用户可以浏览已发布的随笔。


### 评论随笔
```puml
title 评论随笔
|用户|
start
: 编辑评论内容;
: 申请发送;

|系统|
if (审核通过?) then(yes)
: 评论发布成功;
: 发送评论提醒;
else(no)
stop
endif

|用户|
: 浏览评论;
stop
```

用户可以编辑对某一随笔的评论内容，并申请发送评论。接着，系统会进行审核，如果审核通过，则系统会提示用户评论发布成功，并向随笔发布者发送评论提醒。如果审核不通过，则系统会停止流程。最后，用户可以浏览已发布的评论。

### 删除随笔
```puml
title 删除随笔
|用户|
: 申请删除随笔;

|系统|
if (是否管理员?) then(no)
|系统|
: 返回个人随笔数据;
|用户|
: 选择删除;

else(yes)
|系统|
: 返回所有随笔数据;
|管理员|
: 选择删除;
endif
|系统|
stop
```
用户可以申请删除随笔。如果用户不是管理员，则系统会返回个人随笔数据，用户可以选择要删除的随笔。如果用户是管理员，则系统会返回所有随笔数据，管理员可以选择要删除的随笔。最后，系统会删除所选的随笔，并停止流程。

### 创建歌单
```puml
title 创建歌单
|用户|
start
: 申请创建歌单;
: 填写主题;
: 设置公开性;

|系统|
: 生成推荐音乐;

|用户|
: 选择音乐;
: 上传音乐;

|系统|
if (审核通过?) then(yes)
: 创建成功;
: 匹配相关情绪用户;
: 推荐至用户主页;
|用户|
: 听音乐;
else(no);
|系统|
: 创建失败;
endif
|系统|
stop
```

用户可以申请创建歌单，其需要填写歌单主题并设置公开性。接着，系统会生成推荐音乐，用户可以根据推荐的音乐选择或上传自己所喜爱的音乐。接下来，系统会对音乐进行审核，如果审核通过，则系统会提示用户创建成功。同时，系统会匹配相关情绪的用户，并将歌单推荐至用户的主页。最后，用户可以听歌单中的音乐。如果审核不通过，则系统会提示用户创建失败。

### 心情打卡
```puml
title 心情打卡
|用户|
start
: 申请心情打卡;
|系统|
: 发送问卷;
|用户|
: 填写问卷;
|系统|
: 调用推荐算法;
: 生成推荐音乐;
|用户|
: 接受音乐;
stop
```
用户登录后，可以申请心情打卡，系统会发送问卷给用户进行填写。接着，系统会调用推荐算法，根据所填写问卷的结果，生成推荐音乐并发送给用户。最后，用户可以从中接受推荐的音乐。

## 音乐室系统
### 创建音乐室
```puml
title 创建音乐室
|用户|
start
: 申请创建音乐室;
: 填写主题、人数与时间段;

|系统|
if (是否有空闲音乐室?) then(yes)
: 为创建者添加该音乐室群主权限;
: 匹配相关情绪用户;
: 发送音乐室推荐;
|用户|
: 创建音乐室歌单;

else(no)
|系统|
: 创建失败;
endif
stop
```

用户可以申请创建音乐室开始，用户需要填写音乐室的主题、人数以及时间段。系统会判断是否有空闲音乐室，如果有，则为创建者添加该音乐室群主权限，匹配相关情绪用户，然后发送音乐室推荐给用户。用户可以创建音乐室歌单。如果没有空闲音乐室，则创建失败。

### 退出音乐室
```puml
title 退出音乐室
|用户|
start
: 申请退出音乐室;

|系统|
if (是否群主?) then(yes)
|系统|
: 发送提示转移群主身份;
|用户|
: 选择群内用户转移群主身份;



else(no)
endif
|系统|
: 移除等待队列中该用户所选歌曲;
: 退出成功;
stop
```
用户可以退出音乐室。如果该用户是群主，则系统会发送提示并要求该用户选择群内的其他用户作为新的群主；如果该用户不是群主，则直接执行退出操作。注意退出时需要移除等待队列中该用户所选择的歌曲

### 加入音乐室
```puml
title 加入音乐室
|用户|
start
: 选择音乐室;
: 申请加入音乐室;
|群管理员|
if (审核通过?) then(no)
|用户|
: 加入失败;

else(yes)
|群管理员|
: 同意加入;
|用户|
: 加入成功;

endif
|群管理员|
stop
```
用户在已经建立的音乐室中选择自己喜欢的主题的音乐室，申请加入，然后经过群管理员审核验证，若审核通过用户成功加入该音乐室，若审核不通过则加入失败。


### 群内唱歌
```puml
title 群内唱歌
|用户|
start
: 申请唱歌;
: 选择歌曲;

|系统|
if (是否群管理员?) then(yes)
|群管理员|
fork 
: 调整歌单顺序;
fork again
: 增删歌单;
endfork

else(no)
|群管理员|
if (审核通过?) then(yes)
: 加入等待唱歌队列;
else(no)
: 提示用户重新选择歌曲;
stop
endif


if (无人等待) then(yes)
|用户|
: 唱歌;
endif
endif
|系统|
: 识别情绪;
: 推荐音乐至相关情绪用户;
stop
```

用户可以在群内申请唱歌并选择歌曲。如果用户是群管理员，则可以调整歌单顺序或者增删歌单。如果用户不是群管理员，管理员会审核通过，就将其加入等待唱歌队列；若没有通过需要向用户发送重新选择歌曲的提示。如果当前队列中没有其他用户等待唱歌，则该用户可以开始唱歌。在唱歌过程中，系统可以识别用户的情绪并根据情绪推荐相关音乐给其他用户。

### 解散音乐室
```puml
|用户|
start
: 申请解散音乐室;
|系统|
if (具有群主权限?) then(yes)
: 等待当前正在演唱歌曲完成;
: 向全体成员发送提示;
: 解散成功;
else(no)
: 解散失败;
endif
stop
```
用户申请解散音乐室，然后系统判断该用户拥有该音乐室群主权限，若有，等待当前音乐室正在演唱歌曲完成，然后音乐室解散成功；若没有群主权限则解散失败。